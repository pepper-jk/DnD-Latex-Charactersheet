\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{dndcharactersheet}[2018/09/14 D&D Character Sheet]

\RequirePackage{pdfpages}
\RequirePackage{tikz}
\RequirePackage{amsmath}
\RequirePackage{array}
\RequirePackage[most]{tcolorbox}
\RequirePackage{setspace}
\RequirePackage{xkeyval}
\RequirePackage{ifthen}
\RequirePackage{xparse}

\newif\ifalt

\DeclareOptionX{base}{\def\basepdf{#1}}
\DeclareOptionX{alt}{\alttrue}
\ProcessOptionsX\relax


\define@key[DndBase]{Base}{Character}{\setkeys[DndBase]{Character}{#1}}
\define@key[DndBase]{Base}{Abilities}{\setkeys[DndBase]{Abilities}{#1}}
\define@key[DndBase]{Base}{Inspiration}{\def\@DndBase@Base@Inspiration{#1}}
\define@key[DndBase]{Base}{Proficiencies}{\setkeys[DndBase]{Proficiencies}{
	Strength=0,Dexterity=0,Constitution=0,
	Intelligence=0,Wisdom=0,Charisma=0,#1}}
\define@key[DndBase]{Base}{Skills}{\setkeys[DndBase]{Skills}{
	Acrobatics=0,Animals=0,Arcana=0,Athletics=0,
	Deception=0,History=0,Insight=0,Intimidation=0,
	Investigation=0,Medicine=0,Nature=0,Perception=0,
	Performance=0,Persuasion=0,Religion=0,
	SleightOfHand=0,Stealth=0,Survival=0,#1}}
\define@key[DndBase]{Base}{Perception}{\def\@DndBase@Base@Perception{#1}}
\define@key[DndBase]{Base}{OtherProficiencies}{\def\@DndBase@Base@OtherProficiencies{#1}}
\define@key[DndBase]{Base}{Armor}{\def\@DndBase@Base@Armor{#1}}
\define@key[DndBase]{Base}{Initiative}{\def\@DndBase@Base@Initiative{#1}}
\define@key[DndBase]{Base}{InitBonus}{\def\@DndBase@Base@InitBonus{#1}}
\define@key[DndBase]{Base}{Speed}{\def\@DndBase@Base@Speed{#1}}
\define@key[DndBase]{Base}{Hitpoints}{\setkeys[DndBase]{Hitpoints}{#1}}
\define@key[DndBase]{Base}{Hitdice}{\setkeys[DndBase]{Hitdice}{#1}}
\define@key[DndBase]{Base}{Weapons}{\setkeys[DndBase]{Weapons}{#1}}
\define@key[DndBase]{Base}{Money}{\setkeys[DndBase]{Money}{#1}}
\define@key[DndBase]{Base}{Equipment}{\def\@DndBase@Base@Equipment{#1}}
\define@key[DndBase]{Base}{Traits}{\def\@DndBase@Base@Traits{#1}}
\define@key[DndBase]{Base}{Ideals}{\def\@DndBase@Base@Ideals{#1}}
\define@key[DndBase]{Base}{Bonds}{\def\@DndBase@Base@Bonds{#1}}
\define@key[DndBase]{Base}{Flaws}{\def\@DndBase@Base@Flaws{#1}}
\define@key[DndBase]{Base}{Features}{\def\@DndBase@Base@Features{#1}}
\define@key[DndBase]{Base}{Notes}{\def\@DndBase@Base@Notes{#1}}

\define@key[DndBase]{Character}{Name}{\def\@DndBase@Character@Name{#1}}
\define@key[DndBase]{Character}{Class}{\def\@DndBase@Character@Class{#1}}
\define@key[DndBase]{Character}{Background}{\def\@DndBase@Character@Background{#1}}
\define@key[DndBase]{Character}{Player}{\def\@DndBase@Character@Player{#1}}
\define@key[DndBase]{Character}{Race}{\def\@DndBase@Character@Race{#1}}
\define@key[DndBase]{Character}{Alignment}{\def\@DndBase@Character@Alignment{#1}}
\define@key[DndBase]{Character}{Exp}{\def\@DndBase@Character@Exp{#1}}

\define@key[DndBase]{Abilities}{Strength}{\def\@DndBase@Abilities@Strength{#1}}
\define@key[DndBase]{Abilities}{Dexterity}{\def\@DndBase@Abilities@Dexterity{#1}}
\define@key[DndBase]{Abilities}{Constitution}{\def\@DndBase@Abilities@Constitution{#1}}
\define@key[DndBase]{Abilities}{Intelligence}{\def\@DndBase@Abilities@Intelligence{#1}}
\define@key[DndBase]{Abilities}{Wisdom}{\def\@DndBase@Abilities@Wisdom{#1}}
\define@key[DndBase]{Abilities}{Charisma}{\def\@DndBase@Abilities@Charisma{#1}}

\define@key[DndBase]{Proficiencies}{Strength}[1]{\def\@DndBase@Proficiencies@Strength{#1}}
\define@key[DndBase]{Proficiencies}{Dexterity}[1]{\def\@DndBase@Proficiencies@Dexterity{#1}}
\define@key[DndBase]{Proficiencies}{Constitution}[1]{\def\@DndBase@Proficiencies@Constitution{#1}}
\define@key[DndBase]{Proficiencies}{Intelligence}[1]{\def\@DndBase@Proficiencies@Intelligence{#1}}
\define@key[DndBase]{Proficiencies}{Wisdom}[1]{\def\@DndBase@Proficiencies@Wisdom{#1}}
\define@key[DndBase]{Proficiencies}{Charisma}[1]{\def\@DndBase@Proficiencies@Charisma{#1}}

\define@key[DndBase]{Skills}{Acrobatics}[1]{\def\@DndBase@Skills@Acrobatics{#1}}
\define@key[DndBase]{Skills}{Animals}[1]{\def\@DndBase@Skills@Animals{#1}}
\define@key[DndBase]{Skills}{Arcana}[1]{\def\@DndBase@Skills@Arcana{#1}}
\define@key[DndBase]{Skills}{Athletics}[1]{\def\@DndBase@Skills@Athletics{#1}}
\define@key[DndBase]{Skills}{Deception}[1]{\def\@DndBase@Skills@Deception{#1}}
\define@key[DndBase]{Skills}{History}[1]{\def\@DndBase@Skills@History{#1}}
\define@key[DndBase]{Skills}{Insight}[1]{\def\@DndBase@Skills@Insight{#1}}
\define@key[DndBase]{Skills}{Intimidation}[1]{\def\@DndBase@Skills@Intimidation{#1}}
\define@key[DndBase]{Skills}{Investigation}[1]{\def\@DndBase@Skills@Investigation{#1}}
\define@key[DndBase]{Skills}{Medicine}[1]{\def\@DndBase@Skills@Medicine{#1}}
\define@key[DndBase]{Skills}{Nature}[1]{\def\@DndBase@Skills@Nature{#1}}
\define@key[DndBase]{Skills}{Perception}[1]{\def\@DndBase@Skills@Perception{#1}}
\define@key[DndBase]{Skills}{Performance}[1]{\def\@DndBase@Skills@Performance{#1}}
\define@key[DndBase]{Skills}{Persuasion}[1]{\def\@DndBase@Skills@Persuasion{#1}}
\define@key[DndBase]{Skills}{Religion}[1]{\def\@DndBase@Skills@Religion{#1}}
\define@key[DndBase]{Skills}{SleightOfHand}[1]{\def\@DndBase@Skills@SleightOfHand{#1}}
\define@key[DndBase]{Skills}{Stealth}[1]{\def\@DndBase@Skills@Stealth{#1}}
\define@key[DndBase]{Skills}{Survival}[1]{\def\@DndBase@Skills@Survival{#1}}

\define@key[DndBase]{Hitpoints}{Maximum}{\def\@DndBase@Hitpoints@Maximum{#1}}
\define@key[DndBase]{Hitpoints}{Current}{\def\@DndBase@Hitpoints@Current{#1}}
\define@key[DndBase]{Hitpoints}{Temporary}{\def\@DndBase@Hitpoints@Temporary{#1}}

\define@key[DndBase]{Hitdice}{Count}{\def\@DndBase@Hitdice@Count{#1}}
\define@key[DndBase]{Hitdice}{Desc}{\def\@DndBase@Hitdice@Desc{#1}}

\define@key[DndBase]{Weapons}{Weapon1}{\setkeys[DndBase]{Weapon1}{#1}}
\define@key[DndBase]{Weapons}{Weapon2}{\setkeys[DndBase]{Weapon2}{#1}}
\define@key[DndBase]{Weapons}{Weapon3}{\setkeys[DndBase]{Weapon3}{#1}}
\define@key[DndBase]{Weapons}{Notes}{\def\@DndBase@Weapons@Notes{#1}}

\define@key[DndBase]{Money}{Copper}{\def\@DndBase@Money@Copper{#1}}
\define@key[DndBase]{Money}{Silver}{\def\@DndBase@Money@Silver{#1}}
\define@key[DndBase]{Money}{Electrum}{\def\@DndBase@Money@Electrum{#1}}
\define@key[DndBase]{Money}{Gold}{\def\@DndBase@Money@Gold{#1}}
\define@key[DndBase]{Money}{Platin}{\def\@DndBase@Money@Platin{#1}}

\define@key[DndBase]{Weapon1}{Name}{\def\@DndBase@WeaponA@Name{#1}}
\define@key[DndBase]{Weapon1}{AtkBonus}{\def\@DndBase@WeaponA@AtkBonus{#1}}
\define@key[DndBase]{Weapon1}{Damage}{\def\@DndBase@WeaponA@Damage{#1}}
\define@key[DndBase]{Weapon1}{Type}{\def\@DndBase@WeaponA@Type{#1}}

\define@key[DndBase]{Weapon2}{Name}{\def\@DndBase@WeaponB@Name{#1}}
\define@key[DndBase]{Weapon2}{AtkBonus}{\def\@DndBase@WeaponB@AtkBonus{#1}}
\define@key[DndBase]{Weapon2}{Damage}{\def\@DndBase@WeaponB@Damage{#1}}
\define@key[DndBase]{Weapon2}{Type}{\def\@DndBase@WeaponB@Type{#1}}

\define@key[DndBase]{Weapon3}{Name}{\def\@DndBase@WeaponC@Name{#1}}
\define@key[DndBase]{Weapon3}{AtkBonus}{\def\@DndBase@WeaponC@AtkBonus{#1}}
\define@key[DndBase]{Weapon3}{Damage}{\def\@DndBase@WeaponC@Damage{#1}}
\define@key[DndBase]{Weapon3}{Type}{\def\@DndBase@WeaponC@Type{#1}}


\ExplSyntaxOn

\NewExpandableDocumentCommand\DndLevel{m}{
	\int_compare:nTF {#1 < 300}		{1}
	{\int_compare:nTF {#1 < 900}	{2}
	{\int_compare:nTF {#1 < 2700}	{3}
	{\int_compare:nTF {#1 < 6500}	{4}
	{\int_compare:nTF {#1 < 14000}	{5}
	{\int_compare:nTF {#1 < 23000}	{6}
	{\int_compare:nTF {#1 < 34000}	{7}
	{\int_compare:nTF {#1 < 48000}	{8}
	{\int_compare:nTF {#1 < 64000}	{9}
	{\int_compare:nTF {#1 < 85000}	{10}
	{\int_compare:nTF {#1 < 100000}	{11}
	{\int_compare:nTF {#1 < 120000}	{12}
	{\int_compare:nTF {#1 < 140000}	{13}
	{\int_compare:nTF {#1 < 165000}	{14}
	{\int_compare:nTF {#1 < 195000}	{15}
	{\int_compare:nTF {#1 < 225000}	{16}
	{\int_compare:nTF {#1 < 265000}	{17}
	{\int_compare:nTF {#1 < 305000}	{18}
	{\int_compare:nTF {#1 < 355000}	{19}
									{20}
	}}}}}}}}}}}}}}}}}}
}

\NewExpandableDocumentCommand\DndProficiencyBonus{m}{
	\int_compare:nTF {#1 < 5}	{2}
	{\int_compare:nTF {#1 < 9}	{3}
	{\int_compare:nTF {#1 < 13}	{4}
	{\int_compare:nTF {#1 < 17}	{5}
								{6}
	}}}
}

\NewExpandableDocumentCommand\DndGetAbilityModifier{m}{
	\fp_eval:n{trunc(#1 / 2 - 5, 0)}
}

\NewExpandableDocumentCommand\DndInitBonus{m}{
	\fp_eval:n{#1 + \DndGetAbilityModifier{\@DndBase@Abilities@Dexterity}}
}

\NewExpandableDocumentCommand\DndDisplaySignedNum{m}{
	\int_compare:nNnTF
	{ #1 } < { 0 }
	{ $   #1 $ }
	{ $ + #1 $ }
}

\NewExpandableDocumentCommand\DndGetSavingThrow{m m}{
	\fp_eval:n{#1 + #2 * \DndProficiencyBonus{\DndLevel{\@DndBase@Character@Exp}}}
}

\NewExpandableDocumentCommand\DndGetPassiveWisdom{}{
	\fp_eval:n{10 + \DndGetAbilityModifier{\@DndBase@Abilities@Wisdom}}
}

\ExplSyntaxOff

\newcommand\DndCharacterSheet[1]{
	\setkeys[DndBase]{Base}{Skills={},Proficiencies={},#1}

	\includepdf[pages=1, pagecommand={\ifthispageodd{
		\begin{tikzpicture}[remember picture, overlay,x=1cm,y=1cm,shift={(1.31,0)}]
	} {
		\begin{tikzpicture}[remember picture, overlay,x=1cm,y=1cm,shift={(-1.31,0)}]
	}
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		%
		%   Character Information
		%
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		%
		% Character Name
		\ifdefined\@DndBase@Character@Name
			\node[draw=none,rectangle,text width=5.7 cm,align=center] at (0.3,0.4) {\huge \@DndBase@Character@Name};
		\fi
		% Class & level
		\ifdefined\@DndBase@Character@Class
			\node[draw=none,rectangle,text width=3.5 cm] at (6.7 , 0.8) {\@DndBase@Character@Class};
		\fi
		% Background
		\ifdefined\@DndBase@Character@Background
			\node[draw=none,rectangle,text width=3.0 cm] at (10.3, 0.8) {\@DndBase@Character@Background};
		\fi
		% Player name
		\ifdefined\@DndBase@Character@Player
			\node[draw=none,rectangle,text width=3.0 cm] at (13.7, 0.8) {\@DndBase@Character@Player};
		\fi
		% Race
		\ifdefined\@DndBase@Character@Race
			\node[draw=none,rectangle,text width=3.5 cm] at (6.7 ,-0.1) {\@DndBase@Character@Race};
		\fi
		% Alignment
		\ifdefined\@DndBase@Character@Alignment
			\node[draw=none,rectangle,text width=3.0 cm] at (10.3,-0.1) {\@DndBase@Character@Alignment};
		\fi
		% Experience points
		\ifdefined\@DndBase@Character@Exp
			\node[draw=none,rectangle,text width=3.0 cm] at (13.7,-0.1) {\@DndBase@Character@Exp};
		\fi
		%
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		%
		%   Ability scores
		%
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		%
		% Positional variables
		\ifalt
			\def \@Abilities@x {-2.15}
			\def \@Abilities@y {-4.30}
			\def \@Abilities@dist {-2.34}
		\else
			\def \@Abilities@x {-2.34}
			\def \@Abilities@y {-3.81}
			\def \@Abilities@dist {-2.46}
		\fi
		% Strength
		\ifdefined\@DndBase@Abilities@Strength
			\node[draw=none,rectangle,text width=0.4 cm,align=center] at (\@Abilities@x, \@Abilities@y) {\@DndBase@Abilities@Strength};
		\fi
		% Dexterity
		\ifdefined\@DndBase@Abilities@Dexterity
			\node[draw=none,rectangle,text width=0.4 cm,align=center] at (\@Abilities@x,\@Abilities@y+\@Abilities@dist) {\@DndBase@Abilities@Dexterity};
		\fi
		% Constitution
		\ifdefined\@DndBase@Abilities@Constitution
			\node[draw=none,rectangle,text width=0.4 cm,align=center] at (\@Abilities@x,\@Abilities@y+2*\@Abilities@dist) {\@DndBase@Abilities@Constitution};
		\fi
		% Intelligence
		\ifdefined\@DndBase@Abilities@Intelligence
			\node[draw=none,rectangle,text width=0.4 cm,align=center] at (\@Abilities@x,\@Abilities@y+3*\@Abilities@dist) {\@DndBase@Abilities@Intelligence};
		\fi
		% Wisdom
		\ifdefined\@DndBase@Abilities@Wisdom
			\node[draw=none,rectangle,text width=0.4 cm,align=center] at (\@Abilities@x,\@Abilities@y+4*\@Abilities@dist) {\@DndBase@Abilities@Wisdom};
		\fi
		% Charisma
		\ifdefined\@DndBase@Abilities@Charisma
			\node[draw=none,rectangle,text width=0.4 cm,align=center] at (\@Abilities@x,\@Abilities@y+5*\@Abilities@dist) {\@DndBase@Abilities@Charisma};
		\fi
		%
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		%
		%   Ability modifactors
		%
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		%
		% Positional variables
		\ifalt
			\def \@AbilityMods@x {-2.15}
			\def \@AbilityMods@y {-5.15}
			\def \@AbilityMods@dist {-2.35}
		\else
			\def \@AbilityMods@x {-2.34}
			\def \@AbilityMods@y {-2.95}
			\def \@AbilityMods@dist {-2.46}
		\fi
		% Strength
		\ifdefined\@DndBase@Abilities@Strength
			\node[draw=none,rectangle,text width=1.2 cm,align=center] at (\@AbilityMods@x, \@AbilityMods@y) {
				\huge \DndDisplaySignedNum{\DndGetAbilityModifier{\@DndBase@Abilities@Strength}}};
		\fi
		% Dexterity
		\ifdefined\@DndBase@Abilities@Dexterity
			\node[draw=none,rectangle,text width=1.2 cm,align=center] at (\@AbilityMods@x, \@AbilityMods@y+\@AbilityMods@dist) {
				\huge \DndDisplaySignedNum{\DndGetAbilityModifier{\@DndBase@Abilities@Dexterity}}};
		\fi
		% Constitution
		\ifdefined\@DndBase@Abilities@Constitution
			\node[draw=none,rectangle,text width=1.2 cm,align=center] at (\@AbilityMods@x, \@AbilityMods@y+2*\@AbilityMods@dist) {
				\huge \DndDisplaySignedNum{\DndGetAbilityModifier{\@DndBase@Abilities@Constitution}}};
		\fi
		% Intelligence
		\ifdefined\@DndBase@Abilities@Intelligence
			\node[draw=none,rectangle,text width=1.2 cm,align=center] at (\@AbilityMods@x, \@AbilityMods@y+3*\@AbilityMods@dist) {
				\huge \DndDisplaySignedNum{\DndGetAbilityModifier{\@DndBase@Abilities@Intelligence}}};
		\fi
		% Wisdom
		\ifdefined\@DndBase@Abilities@Wisdom
			\node[draw=none,rectangle,text width=1.2 cm,align=center] at (\@AbilityMods@x, \@AbilityMods@y+4*\@AbilityMods@dist) {
				\huge \DndDisplaySignedNum{\DndGetAbilityModifier{\@DndBase@Abilities@Wisdom}}};
		\fi
		% Charisma
		\ifdefined\@DndBase@Abilities@Charisma
			\node[draw=none,rectangle,text width=1.2 cm,align=center] at (\@AbilityMods@x, \@AbilityMods@y+5*\@AbilityMods@dist) {
				\huge \DndDisplaySignedNum{\DndGetAbilityModifier{\@DndBase@Abilities@Charisma}}};
		\fi
		%
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		%
		%   Inspiration
		%
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		%
		% Positional variables
		\ifalt
			\def \@Inspiration@x {-2.12}
			\def \@Inspiration@y {-3.27}
		\else
			\def \@Inspiration@x {-0.6}
			\def \@Inspiration@y {-2}
		\fi
		%
		\ifdefined\@DndBase@Base@Inspiration
			\node[draw=none,rectangle,text width=0.5 cm,align=center] at (\@Inspiration@x,\@Inspiration@y) {\@DndBase@Base@Inspiration};
		\fi
		%
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		%
		%   Proficiency bonus
		%
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		%
		% Positional variables
		\ifalt
			\def \@ProBonus@x {-2.14}
			\def \@ProBonus@y {-2.32}
		\else
			\def \@ProBonus@x {-0.56}
			\def \@ProBonus@y {-3.27}
		\fi
		%
		\node[draw=none,rectangle,text width=0.5 cm,align=center] at (\@ProBonus@x,\@ProBonus@y) {\DndDisplaySignedNum{\DndProficiencyBonus{\DndLevel{\@DndBase@Character@Exp}}}};
		%
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		%
		%   Saving throw proficiency
		%   (uncomment to enable, comment to disable)
		%
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		%
		% Positional variables
		\ifalt
			\def \@Saves@x {-0.66}
			\def \@Saves@y {-4.225}
			\def \@Saves@dist {-2.34}
		\else
			\def \@Saves@x {-0.71}
			\def \@Saves@y {-4.45}
			\def \@Saves@dist {-0.463}
		\fi
		% Strength
		\ifnum \@DndBase@Proficiencies@Strength > 0
			\node[circle,fill,inner sep=1.2pt,label=] at (\@Saves@x, \@Saves@y) {};
		\fi
		% Dexterity
		\ifnum \@DndBase@Proficiencies@Dexterity > 0
			\node[circle,fill,inner sep=1.2pt,label=] at (\@Saves@x, \@Saves@y+\@Saves@dist) {};
		\fi
		% Constitution
		\ifnum \@DndBase@Proficiencies@Constitution > 0
			\node[circle,fill,inner sep=1.2pt,label=] at (\@Saves@x, \@Saves@y+2*\@Saves@dist) {};
		\fi
		% Intelligence
		\ifnum \@DndBase@Proficiencies@Intelligence > 0
			\node[circle,fill,inner sep=1.2pt,label=] at (\@Saves@x, \@Saves@y+3*\@Saves@dist) {};
		\fi
		% Wisdom
		\ifnum \@DndBase@Proficiencies@Wisdom > 0
			\node[circle,fill,inner sep=1.2pt,label=] at (\@Saves@x, \@Saves@y+4*\@Saves@dist) {};
		\fi
		% Charisma
		\ifnum \@DndBase@Proficiencies@Charisma > 0
			\node[circle,fill,inner sep=1.2pt,label=] at (\@Saves@x, \@Saves@y+5*\@Saves@dist) {};
		\fi
		%
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		%
		%   Saving throws values
		%
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		%
		% Positional variables
		\ifalt
			\def \@SaveValues@x {-0.25}
			\def \@SaveValues@y {-4.20}
		\else
			\def \@SaveValues@x {-0.20}
			\def \@SaveValues@y {-4.45}
		\fi
		\def \@SaveValues@dist {\@Saves@dist}
		% Strength
		\ifdefined\@DndBase@Abilities@Charisma
			\node[draw=none,rectangle,text width=0.5 cm,align=right] at (\@SaveValues@x, \@SaveValues@y) {\small
				\DndDisplaySignedNum{\DndGetSavingThrow{\DndGetAbilityModifier{\@DndBase@Abilities@Strength}}{\@DndBase@Proficiencies@Strength}}};
		\fi
		% Dexterity
		\ifdefined\@DndBase@Abilities@Dexterity
			\node[draw=none,rectangle,text width=0.5 cm,align=right] at (\@SaveValues@x, \@SaveValues@y+\@SaveValues@dist) {\small
				\DndDisplaySignedNum{\DndGetSavingThrow{\DndGetAbilityModifier{\@DndBase@Abilities@Dexterity}}{\@DndBase@Proficiencies@Dexterity}}};
		\fi
		% Constitution
		\ifdefined\@DndBase@Abilities@Constitution
			\node[draw=none,rectangle,text width=0.5 cm,align=right] at (\@SaveValues@x, \@SaveValues@y+2*\@SaveValues@dist) {\small
				\DndDisplaySignedNum{\DndGetSavingThrow{\DndGetAbilityModifier{\@DndBase@Abilities@Constitution}}{\@DndBase@Proficiencies@Constitution}}};
		\fi
		% Intelligence
		\ifdefined\@DndBase@Abilities@Intelligence
			\node[draw=none,rectangle,text width=0.5 cm,align=right] at (\@SaveValues@x, \@SaveValues@y+3*\@SaveValues@dist) {\small
				\DndDisplaySignedNum{\DndGetSavingThrow{\DndGetAbilityModifier{\@DndBase@Abilities@Intelligence}}{\@DndBase@Proficiencies@Intelligence}}};
		\fi
		% Wisdom
		\ifdefined\@DndBase@Abilities@Wisdom
			\node[draw=none,rectangle,text width=0.5 cm,align=right] at (\@SaveValues@x, \@SaveValues@y+4*\@SaveValues@dist) {\small
				\DndDisplaySignedNum{\DndGetSavingThrow{\DndGetAbilityModifier{\@DndBase@Abilities@Wisdom}}{\@DndBase@Proficiencies@Wisdom}}};
		\fi
		% Charisma
		\ifdefined\@DndBase@Abilities@Charisma
			\node[draw=none,rectangle,text width=0.5 cm,align=right] at (\@SaveValues@x, \@SaveValues@y+5*\@SaveValues@dist) {\small
				\DndDisplaySignedNum{\DndGetSavingThrow{\DndGetAbilityModifier{\@DndBase@Abilities@Charisma}}{\@DndBase@Proficiencies@Charisma}}};
		\fi
		%
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		%
		%   Skill proficiency
		%   (uncomment to enable, comment to disable)
		%
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		%
		% Positional variables
		\ifalt
			\def \@Skills@x {-0.66}
			\def \@Skills@dist {-0.33}
			% Strength
			\def \@STR@y {-4.58}
			\def \@Athletics@x {\@Skills@x}
			\def \@Athletics@y {\@STR@y}
			% Dexterity
			\def \@DEX@y {-6.92}
			\def \@Acrobatics@x {\@Skills@x}
			\def \@Acrobatics@y {\@DEX@y}
			\def \@SleightOfHand@x {\@Skills@x}
			\def \@SleightOfHand@y {\@DEX@y+\@Skills@dist}
			\def \@Stealth@x {\@Skills@x}
			\def \@Stealth@y {\@DEX@y+2*\@Skills@dist}
			% Intelligence
			\def \@INT@y {-11.6}
			\def \@Arcana@x {\@Skills@x}
			\def \@Arcana@y {\@INT@y}
			\def \@History@x {\@Skills@x}
			\def \@History@y {\@INT@y+\@Skills@dist}
			\def \@Investigation@x {\@Skills@x}
			\def \@Investigation@y {\@INT@y+2*\@Skills@dist}
			\def \@Nature@x {\@Skills@x}
			\def \@Nature@y {\@INT@y+3*\@Skills@dist}
			\def \@Religion@x {\@Skills@x}
			\def \@Religion@y {\@INT@y+4*\@Skills@dist}
			% Wisdom
			\def \@WIS@y {-13.94}
			\def \@Animal@x {\@Skills@x}
			\def \@Animal@y {\@WIS@y}
			\def \@Insight@x {\@Skills@x}
			\def \@Insight@y {\@WIS@y+\@Skills@dist}
			\def \@Medicine@x {\@Skills@x}
			\def \@Medicine@y {\@WIS@y+2*\@Skills@dist}
			\def \@Perception@x {\@Skills@x}
			\def \@Perception@y {\@WIS@y+3*\@Skills@dist}
			\def \@Survival@x {\@Skills@x}
			\def \@Survival@y {\@WIS@y+4*\@Skills@dist}
			% Charisma
			\def \@CHA@y {-16.28}
			\def \@Deception@x {\@Skills@x}
			\def \@Deception@y {\@CHA@y}
			\def \@Intimidation@x {\@Skills@x}
			\def \@Intimidation@y {\@CHA@y+\@Skills@dist}
			\def \@Performance@x {\@Skills@x}
			\def \@Performance@y {\@CHA@y+2*\@Skills@dist}
			\def \@Persuasion@x {\@Skills@x}
			\def \@Persuasion@y {\@CHA@y+3*\@Skills@dist}
		\else
			\def \@Skills@x {-0.71}
			\def \@Skills@y {-8.40}
			\def \@Skills@dist {-0.4635}
			\def \@Acrobatics@x {\@Skills@x}
			\def \@Acrobatics@y {\@Skills@y}
			\def \@Animal@x {\@Skills@x}
			\def \@Animal@y {\@Skills@y+\@Skills@dist}
			\def \@Arcana@x {\@Skills@x}
			\def \@Arcana@y {\@Skills@y+2*\@Skills@dist}
			\def \@Athletics@x {\@Skills@x}
			\def \@Athletics@y {\@Skills@y+3*\@Skills@dist}
			\def \@Deception@x {\@Skills@x}
			\def \@Deception@y {\@Skills@y+4*\@Skills@dist}
			\def \@History@x {\@Skills@x}
			\def \@History@y {\@Skills@y+5*\@Skills@dist}
			\def \@Insight@x {\@Skills@x}
			\def \@Insight@y {\@Skills@y+6*\@Skills@dist}
			\def \@Intimidation@x {\@Skills@x}
			\def \@Intimidation@y {\@Skills@y+7*\@Skills@dist}
			\def \@Investigation@x {\@Skills@x}
			\def \@Investigation@y {\@Skills@y+8*\@Skills@dist}
			\def \@Medicine@x {\@Skills@x}
			\def \@Medicine@y {\@Skills@y+9*\@Skills@dist}
			\def \@Nature@x {\@Skills@x}
			\def \@Nature@y {\@Skills@y+10*\@Skills@dist}
			\def \@Perception@x {\@Skills@x}
			\def \@Perception@y {\@Skills@y+11*\@Skills@dist}
			\def \@Performance@x {\@Skills@x}
			\def \@Performance@y {\@Skills@y+12*\@Skills@dist}
			\def \@Persuasion@x {\@Skills@x}
			\def \@Persuasion@y {\@Skills@y+13*\@Skills@dist}
			\def \@Religion@x {\@Skills@x}
			\def \@Religion@y {\@Skills@y+14*\@Skills@dist}
			\def \@SleightOfHand@x {\@Skills@x}
			\def \@SleightOfHand@y {\@Skills@y+15*\@Skills@dist}
			\def \@Stealth@x {\@Skills@x}
			\def \@Stealth@y {\@Skills@y+16*\@Skills@dist}
			\def \@Survival@x {\@Skills@x}
			\def \@Survival@y {\@Skills@y+17*\@Skills@dist}
		\fi
		% Acrobatics
		\ifnum \@DndBase@Skills@Acrobatics > 0
			\node[circle,fill,inner sep=1.2pt,label=] at (\@Acrobatics@x, \@Acrobatics@y) {};
		\fi
		% Animal handling
		\ifnum \@DndBase@Skills@Animals > 0
			\node[circle,fill,inner sep=1.2pt,label=] at (\@Animal@x, \@Animal@y) {};
		\fi
		% Arcana
		\ifnum \@DndBase@Skills@Arcana > 0
			\node[circle,fill,inner sep=1.2pt,label=] at (\@Arcana@x, \@Arcana@y) {};
		\fi
		% Athletics
		\ifnum \@DndBase@Skills@Athletics > 0
			\node[circle,fill,inner sep=1.2pt,label=] at (\@Athletics@x, \@Athletics@y) {};
		\fi
		% Deception
		\ifnum \@DndBase@Skills@Deception > 0
			\node[circle,fill,inner sep=1.2pt,label=] at (\@Deception@x, \@Deception@y) {};
		\fi
		% History
		\ifnum \@DndBase@Skills@History > 0
			\node[circle,fill,inner sep=1.2pt,label=] at (\@History@x, \@History@y) {};
		\fi
		% Insight
		\ifnum \@DndBase@Skills@Insight > 0
			\node[circle,fill,inner sep=1.2pt,label=] at (\@Insight@x, \@Insight@y) {};
		\fi
		% Intimidation
		\ifnum \@DndBase@Skills@Intimidation > 0
			\node[circle,fill,inner sep=1.2pt,label=] at (\@Intimidation@x, \@Intimidation@y) {};
		\fi
		% Investigation
		\ifnum \@DndBase@Skills@Investigation > 0
			\node[circle,fill,inner sep=1.2pt,label=] at (\@Investigation@x, \@Investigation@y) {};
		\fi
		% Medicine
		\ifnum \@DndBase@Skills@Medicine > 0
			\node[circle,fill,inner sep=1.2pt,label=] at (\@Medicine@x, \@Medicine@y) {};
		\fi
		% Nature
		\ifnum \@DndBase@Skills@Nature > 0
			\node[circle,fill,inner sep=1.2pt,label=] at (\@Nature@x, \@Nature@y) {};
		\fi
		% Perception
		\ifnum \@DndBase@Skills@Perception > 0
			\node[circle,fill,inner sep=1.2pt,label=] at (\@Perception@x, \@Perception@y) {};
		\fi
		% Performance
		\ifnum \@DndBase@Skills@Performance > 0
			\node[circle,fill,inner sep=1.2pt,label=] at (\@Performance@x, \@Performance@y) {};
		\fi
		% Persuasion
		\ifnum \@DndBase@Skills@Persuasion > 0
			\node[circle,fill,inner sep=1.2pt,label=] at (\@Persuasion@x, \@Persuasion@y) {};
		\fi
		% Religion
		\ifnum \@DndBase@Skills@Religion > 0
			\node[circle,fill,inner sep=1.2pt,label=] at (\@Religion@x, \@Religion@y) {};
		\fi
		% Sleight of hand
		\ifnum \@DndBase@Skills@SleightOfHand > 0
			\node[circle,fill,inner sep=1.2pt,label=] at (\@SleightOfHand@x, \@SleightOfHand@y) {};
		\fi
		% Stealth
		\ifnum \@DndBase@Skills@Stealth > 0
			\node[circle,fill,inner sep=1.2pt,label=] at (\@Stealth@x, \@Stealth@y) {};
		\fi
		% Survival
		\ifnum \@DndBase@Skills@Survival > 0
			\node[circle,fill,inner sep=1.2pt,label=] at (\@Survival@x, \@Survival@y) {};
		\fi
		%
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		%
		%   Skill values
		%
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		%
		% Positional variables
		\ifalt
			\def \@SkillValues@x {-0.25}
			% Strength
			\def \@STRValue@y {-4.55}
			\def \@AthleticsValue@x {\@SkillValues@x}
			\def \@AthleticsValue@y {\@STRValue@y}
			% Dexterity
			\def \@DEXValue@y {-6.89}
			\def \@AcrobaticsValue@x {\@SkillValues@x}
			\def \@AcrobaticsValue@y {\@DEXValue@y}
			\def \@SleightOfHandValue@x {\@SkillValues@x}
			\def \@SleightOfHandValue@y {\@DEXValue@y+\@Skills@dist}
			\def \@StealthValue@x {\@SkillValues@x}
			\def \@StealthValue@y {\@DEXValue@y+2*\@Skills@dist}
			% Intelligence
			\def \@INTValue@y {-11.57}
			\def \@ArcanaValue@x {\@SkillValues@x}
			\def \@ArcanaValue@y {\@INTValue@y}
			\def \@HistoryValue@x {\@SkillValues@x}
			\def \@HistoryValue@y {\@INTValue@y+\@Skills@dist}
			\def \@InvestigationValue@x {\@SkillValues@x}
			\def \@InvestigationValue@y {\@INTValue@y+2*\@Skills@dist}
			\def \@NatureValue@x {\@SkillValues@x}
			\def \@NatureValue@y {\@INTValue@y+3*\@Skills@dist}
			\def \@ReligionValue@x {\@SkillValues@x}
			\def \@ReligionValue@y {\@INTValue@y+4*\@Skills@dist}
			% Wisdom
			\def \@WISValue@y {-13.91}
			\def \@AnimalValue@x {\@SkillValues@x}
			\def \@AnimalValue@y {\@WISValue@y}
			\def \@InsightValue@x {\@SkillValues@x}
			\def \@InsightValue@y {\@WISValue@y+\@Skills@dist}
			\def \@MedicineValue@x {\@SkillValues@x}
			\def \@MedicineValue@y {\@WISValue@y+2*\@Skills@dist}
			\def \@PerceptionValue@x {\@SkillValues@x}
			\def \@PerceptionValue@y {\@WISValue@y+3*\@Skills@dist}
			\def \@SurvivalValue@x {\@SkillValues@x}
			\def \@SurvivalValue@y {\@WISValue@y+4*\@Skills@dist}
			% Charisma
			\def \@CHAValue@y {-16.23}
			\def \@DeceptionValue@x {\@SkillValues@x}
			\def \@DeceptionValue@y {\@CHAValue@y}
			\def \@IntimidationValue@x {\@SkillValues@x}
			\def \@IntimidationValue@y {\@CHAValue@y+\@Skills@dist}
			\def \@PerformanceValue@x {\@SkillValues@x}
			\def \@PerformanceValue@y {\@CHAValue@y+2*\@Skills@dist}
			\def \@PersuasionValue@x {\@SkillValues@x}
			\def \@PersuasionValue@y {\@CHAValue@y+3*\@Skills@dist}
		\else
			\def \@SkillValues@x {-0.20}
			\def \@SkillValues@y {-8.40}
			\def \@SkillValues@dist {-0.4635}
			\def \@AcrobaticsValue@x {\@SkillValues@x}
			\def \@AcrobaticsValue@y {\@SkillValues@y}
			\def \@AnimalValue@x {\@SkillValues@x}
			\def \@AnimalValue@y {\@SkillValues@y+\@SkillValues@dist}
			\def \@ArcanaValue@x {\@SkillValues@x}
			\def \@ArcanaValue@y {\@SkillValues@y+2*\@SkillValues@dist}
			\def \@AthleticsValue@x {\@SkillValues@x}
			\def \@AthleticsValue@y {\@SkillValues@y+3*\@SkillValues@dist}
			\def \@DeceptionValue@x {\@SkillValues@x}
			\def \@DeceptionValue@y {\@SkillValues@y+4*\@SkillValues@dist}
			\def \@HistoryValue@x {\@SkillValues@x}
			\def \@HistoryValue@y {\@SkillValues@y+5*\@SkillValues@dist}
			\def \@InsightValue@x {\@SkillValues@x}
			\def \@InsightValue@y {\@SkillValues@y+6*\@SkillValues@dist}
			\def \@IntimidationValue@x {\@SkillValues@x}
			\def \@IntimidationValue@y {\@SkillValues@y+7*\@SkillValues@dist}
			\def \@InvestigationValue@x {\@SkillValues@x}
			\def \@InvestigationValue@y {\@SkillValues@y+8*\@SkillValues@dist}
			\def \@MedicineValue@x {\@SkillValues@x}
			\def \@MedicineValue@y {\@SkillValues@y+9*\@SkillValues@dist}
			\def \@NatureValue@x {\@SkillValues@x}
			\def \@NatureValue@y {\@SkillValues@y+10*\@SkillValues@dist}
			\def \@PerceptionValue@x {\@SkillValues@x}
			\def \@PerceptionValue@y {\@SkillValues@y+11*\@SkillValues@dist}
			\def \@PerformanceValue@x {\@SkillValues@x}
			\def \@PerformanceValue@y {\@SkillValues@y+12*\@SkillValues@dist}
			\def \@PersuasionValue@x {\@SkillValues@x}
			\def \@PersuasionValue@y {\@SkillValues@y+13*\@SkillValues@dist}
			\def \@ReligionValue@x {\@SkillValues@x}
			\def \@ReligionValue@y {\@SkillValues@y+14*\@SkillValues@dist}
			\def \@SleightOfHandValue@x {\@SkillValues@x}
			\def \@SleightOfHandValue@y {\@SkillValues@y+15*\@SkillValues@dist}
			\def \@StealthValue@x {\@SkillValues@x}
			\def \@StealthValue@y {\@SkillValues@y+16*\@SkillValues@dist}
			\def \@SurvivalValue@x {\@SkillValues@x}
			\def \@SurvivalValue@y {\@SkillValues@y+17*\@SkillValues@dist}
		\fi
		% Acrobatics
		\ifdefined\@DndBase@Abilities@Dexterity
			\node[draw=none,rectangle,text width=0.5 cm,align=right] at (\@AcrobaticsValue@x, \@AcrobaticsValue@y) {\small
				\DndDisplaySignedNum{\DndGetSavingThrow{\DndGetAbilityModifier{\@DndBase@Abilities@Dexterity}}{\@DndBase@Skills@Acrobatics}}};
		\fi
		% Animal handling
		\ifdefined\@DndBase@Abilities@Wisdom
			\node[draw=none,rectangle,text width=0.5 cm,align=right] at (\@AnimalValue@x, \@AnimalValue@y) {\small
				\DndDisplaySignedNum{\DndGetSavingThrow{\DndGetAbilityModifier{\@DndBase@Abilities@Wisdom}}{\@DndBase@Skills@Animals}}};
		\fi
		% Arcana
		\ifdefined\@DndBase@Abilities@Intelligence
			\node[draw=none,rectangle,text width=0.5 cm,align=right] at (\@ArcanaValue@x, \@ArcanaValue@y) {\small
				\DndDisplaySignedNum{\DndGetSavingThrow{\DndGetAbilityModifier{\@DndBase@Abilities@Intelligence}}{\@DndBase@Skills@Arcana}}};
		\fi
		% Athletics
		\ifdefined\@DndBase@Abilities@Strength
			\node[draw=none,rectangle,text width=0.5 cm,align=right] at (\@AthleticsValue@x, \@AthleticsValue@y) {\small
				\DndDisplaySignedNum{\DndGetSavingThrow{\DndGetAbilityModifier{\@DndBase@Abilities@Strength}}{\@DndBase@Skills@Athletics}}};
		\fi
		% Deception
		\ifdefined\@DndBase@Abilities@Charisma
			\node[draw=none,rectangle,text width=0.5 cm,align=right] at (\@DeceptionValue@x, \@DeceptionValue@y) {\small
				\DndDisplaySignedNum{\DndGetSavingThrow{\DndGetAbilityModifier{\@DndBase@Abilities@Charisma}}{\@DndBase@Skills@Deception}}};
		\fi
		% History
		\ifdefined\@DndBase@Abilities@Intelligence
			\node[draw=none,rectangle,text width=0.5 cm,align=right] at (\@HistoryValue@x, \@HistoryValue@y) {\small
				\DndDisplaySignedNum{\DndGetSavingThrow{\DndGetAbilityModifier{\@DndBase@Abilities@Intelligence}}{\@DndBase@Skills@History}}};
		\fi
		% Insight
		\ifdefined\@DndBase@Abilities@Wisdom
			\node[draw=none,rectangle,text width=0.5 cm,align=right] at (\@InsightValue@x, \@InsightValue@y) {\small
				\DndDisplaySignedNum{\DndGetSavingThrow{\DndGetAbilityModifier{\@DndBase@Abilities@Wisdom}}{\@DndBase@Skills@Insight}}};
		\fi
		% Intimidation
		\ifdefined\@DndBase@Abilities@Charisma
			\node[draw=none,rectangle,text width=0.5 cm,align=right] at (\@IntimidationValue@x, \@IntimidationValue@y) {\small
				\DndDisplaySignedNum{\DndGetSavingThrow{\DndGetAbilityModifier{\@DndBase@Abilities@Charisma}}{\@DndBase@Skills@Intimidation}}};
		\fi
		% Investigation
		\ifdefined\@DndBase@Abilities@Intelligence
			\node[draw=none,rectangle,text width=0.5 cm,align=right] at (\@InvestigationValue@x, \@InvestigationValue@y) {\small
				\DndDisplaySignedNum{\DndGetSavingThrow{\DndGetAbilityModifier{\@DndBase@Abilities@Intelligence}}{\@DndBase@Skills@Investigation}}};
		\fi
		% Medicine
		\ifdefined\@DndBase@Abilities@Wisdom
			\node[draw=none,rectangle,text width=0.5 cm,align=right] at (\@MedicineValue@x, \@MedicineValue@y) {\small
				\DndDisplaySignedNum{\DndGetSavingThrow{\DndGetAbilityModifier{\@DndBase@Abilities@Wisdom}}{\@DndBase@Skills@Medicine}}};
		\fi
		% Nature
		\ifdefined\@DndBase@Abilities@Intelligence
			\node[draw=none,rectangle,text width=0.5 cm,align=right] at (\@NatureValue@x, \@NatureValue@y) {\small
				\DndDisplaySignedNum{\DndGetSavingThrow{\DndGetAbilityModifier{\@DndBase@Abilities@Intelligence}}{\@DndBase@Skills@Nature}}};
		\fi
		% Perception
		\ifdefined\@DndBase@Abilities@Wisdom
			\node[draw=none,rectangle,text width=0.5 cm,align=right] at (\@PerceptionValue@x, \@PerceptionValue@y) {\small
				\DndDisplaySignedNum{\DndGetSavingThrow{\DndGetAbilityModifier{\@DndBase@Abilities@Wisdom}}{\@DndBase@Skills@Perception}}};
		\fi
		% Performance
		\ifdefined\@DndBase@Abilities@Charisma
			\node[draw=none,rectangle,text width=0.5 cm,align=right] at (\@PerformanceValue@x, \@PerformanceValue@y) {\small
				\DndDisplaySignedNum{\DndGetSavingThrow{\DndGetAbilityModifier{\@DndBase@Abilities@Charisma}}{\@DndBase@Skills@Performance}}};
		\fi
		% Persuasion
		\ifdefined\@DndBase@Abilities@Charisma
			\node[draw=none,rectangle,text width=0.5 cm,align=right] at (\@PersuasionValue@x, \@PersuasionValue@y) {\small
				\DndDisplaySignedNum{\DndGetSavingThrow{\DndGetAbilityModifier{\@DndBase@Abilities@Charisma}}{\@DndBase@Skills@Persuasion}}};
		\fi
		% Religion
		\ifdefined\@DndBase@Abilities@Intelligence
			\node[draw=none,rectangle,text width=0.5 cm,align=right] at (\@ReligionValue@x, \@ReligionValue@y) {\small
				\DndDisplaySignedNum{\DndGetSavingThrow{\DndGetAbilityModifier{\@DndBase@Abilities@Intelligence}}{\@DndBase@Skills@Religion}}};
		\fi
		% Sleight of hand
		\ifdefined\@DndBase@Abilities@Dexterity
			\node[draw=none,rectangle,text width=0.5 cm,align=right] at (\@SleightOfHandValue@x, \@SleightOfHandValue@y) {\small
				\DndDisplaySignedNum{\DndGetSavingThrow{\DndGetAbilityModifier{\@DndBase@Abilities@Dexterity}}{\@DndBase@Skills@SleightOfHand}}};
		\fi
		% Stealth
		\ifdefined\@DndBase@Abilities@Dexterity
			\node[draw=none,rectangle,text width=0.5 cm,align=right] at (\@StealthValue@x, \@StealthValue@y) {\small
				\DndDisplaySignedNum{\DndGetSavingThrow{\DndGetAbilityModifier{\@DndBase@Abilities@Dexterity}}{\@DndBase@Skills@Stealth}}};
		\fi
		% Survival
		\ifdefined\@DndBase@Abilities@Wisdom
			\node[draw=none,rectangle,text width=0.5 cm,align=right] at (\@SurvivalValue@x, \@SurvivalValue@y) {\small
				\DndDisplaySignedNum{\DndGetSavingThrow{\DndGetAbilityModifier{\@DndBase@Abilities@Wisdom}}{\@DndBase@Skills@Survival}}};
		\fi
		%
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		%
		%   Passive wisdom (perception)
		%
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		%
		% Positional variables
		\ifalt
			\def \@PassWis@x {-2.13}
			\def \@PassWis@y {-18.27}
		\else
			\def \@PassWis@x {-2.82}
			\def \@PassWis@y {-17.77}
		\fi
		%
		\ifdefined\@DndBase@Abilities@Wisdom		
			\node[draw=none,rectangle,text width=0.4 cm,align=center] at (\@PassWis@x,\@PassWis@y) {\DndGetPassiveWisdom{}};
		\fi
		%
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		%
		%   OTHER PROFICIENCIES & LANGUAGES
		%   (Sperate lines with '\\')
		%
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		%
		% Positional variables
		\ifalt
			\def \@OtherPro@x {-0.3}
			\def \@OtherPro@y {-21.65}
		\else
			\def \@OtherPro@x {-0.3}
			\def \@OtherPro@y {-20.93}
		\fi
		%
		\ifdefined\@DndBase@Base@OtherProficiencies
			\node[draw=none,rectangle,text width=5.7 cm,align=left] at (\@OtherPro@x,\@OtherPro@y) {%
				\setstretch{0.975}\small
				\parbox[][4.4 cm][t]{5.7 cm}{\@DndBase@Base@OtherProficiencies}
			};
		\fi
		%
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		%
		%   Armor class, Initiative, Speed
		%
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		%
		% Positional variables
		\ifalt
			\def \@AC@y {-2.54}
			\def \@Init@y {-2.78}
		\else
			\def \@AC@y {-2.4}
			\def \@Init@y {-2.64}
		\fi
		\def \@AC@x {4.2}
		\def \@Init@x {6.12}
		\def \@Speed@x {8.15}
		\def \@Speed@y {\@Init@y}
		% Armor class
		\ifdefined\@DndBase@Base@Armor
			\node[draw=none,rectangle,text width=0.8 cm,align=center] at (\@AC@x,\@AC@y) {\huge \@DndBase@Base@Armor};
		\fi
		% Initiative
		\ifdefined\@DndBase@Base@Initiative
			\node[draw=none,rectangle,text width=1.2 cm,align=center] at (\@Init@x,\@Init@y) {\Huge \DndDisplaySignedNum{\@DndBase@Base@Initiative}};
		\else \ifdefined\@DndBase@Base@InitBonus
			\node[draw=none,rectangle,text width=1.2 cm,align=center] at (\@Init@x,\@Init@y) {\Huge \DndDisplaySignedNum{\DndInitBonus{\@DndBase@Base@InitBonus}}};
		\else
			\node[draw=none,rectangle,text width=1.2 cm,align=center] at (\@Init@x,\@Init@y) {\Huge \DndDisplaySignedNum{\DndGetAbilityModifier{\@DndBase@Abilities@Dexterity}}};
		\fi \fi
		% Speed
		\ifdefined\@DndBase@Base@Speed
			\node[draw=none,rectangle,text width=1.2 cm,align=center] at (\@Speed@x,\@Speed@y) {\Huge \@DndBase@Base@Speed};
		\fi
		%
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		%
		%   Hit points
		%
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		%
		% Positional variables
		\ifalt
			\def \@HP@MAX@x {7.55}
			\def \@HP@MAX@y {-4.19}
			\def \@HP@current@x {6.23}
			\def \@HP@current@y {-5}
			\def \@HP@temp@y {-7.1}
		\else
			\def \@HP@MAX@x {7.2}
			\def \@HP@MAX@y {-4.15}
			\def \@HP@current@x {6.21}
			\def \@HP@current@y {-5}
			\def \@HP@temp@y {-6.8}
		\fi
		\def \@HP@temp@x {\@HP@current@x}
		% Hit point maximum
		\ifdefined\@DndBase@Hitpoints@Maximum
			\node[draw=none,rectangle,text width=3 cm,align=left] at (\@HP@MAX@x,\@HP@MAX@y) {\@DndBase@Hitpoints@Maximum};
		\fi
		% Current hit points (Sperate lines with '\\')
		\ifdefined\@DndBase@Hitpoints@Current
			\node[draw=none,rectangle,text width=5.2 cm,align=left] at (\@HP@current@x,\@HP@current@y) {%
				\setstretch{0.98}\small
				\parbox[][0.9 cm][t]{5.2 cm}{\@DndBase@Hitpoints@Current}
			};
		\fi
		% Temporary hit points (Sperate lines with '\\')
		\ifdefined\@DndBase@Hitpoints@Temporary
			\node[draw=none,rectangle,text width=5.2 cm,align=left] at (\@HP@temp@x,\@HP@temp@y) {%
				\setstretch{0.98}\small
				\parbox[][1 cm][t]{5.2 cm}{\@DndBase@Hitpoints@Temporary}
			};
		\fi
		%
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		%
		%   Hit dice
		%
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		%
		% Total hit dice
		\ifdefined\@DndBase@Hitdice@Desc
			\node[draw=none,rectangle,text width=1.6 cm,align=left] at (5.00,-8.28) {\@DndBase@Hitdice@Count\@DndBase@Hitdice@Desc};
		\fi
		% Current hit dice (no need to edit, made only to mark on paper)
		\ifdefined\@DndBase@Hitdice@Count
			\ifnum \@DndBase@Hitdice@Count < 13
				\pgfmathparse{floor(0.5*\@DndBase@Hitdice@Count)-1}
				\ifnum \@DndBase@Hitdice@Count > 1
					\foreach \i in {0,...,\pgfmathresult}{	
						\node[draw,circle,inner sep=3pt,label=,thick] at ({4.75-0.4*(floor((\@DndBase@Hitdice@Count-1)/2)/2 - \i)},-8.7) {};
						\node[draw,circle,inner sep=3pt,label=,thick] at ({4.75-0.4*(floor((\@DndBase@Hitdice@Count-1)/2)/2 - \i)},-9.1) {};
					}
				\fi
				\ifodd \@DndBase@Hitdice@Count
					\node[draw,circle,inner sep=3pt,label=,thick] at ({4.75+0.4*(\@DndBase@Hitdice@Count-1)/4},-8.9) {};
				\fi
			\fi
		\fi
		%
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		%
		%   Attacks & Spellcasting
		%
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		%
		% First Weapon: Name
		\ifdefined\@DndBase@WeaponA@Name
			\node[draw=none,rectangle,text width=2.0 cm,align=left]   at (4.45,-10.96) {\@DndBase@WeaponA@Name};
		\fi
		% First Weapon: Attack bonus
		\ifdefined\@DndBase@WeaponA@AtkBonus
			\node[draw=none,rectangle,text width=0.8 cm,align=center] at (6.25,-10.96) {\DndDisplaySignedNum{\@DndBase@WeaponA@AtkBonus}};
		\fi
		% First Weapon: damage / type
		\ifdefined\@DndBase@WeaponA@Damage
			\ifdefined\@DndBase@WeaponA@Type
				\node[draw=none,rectangle,text width=2.0 cm,align=left]   at (8.00,-10.96) {\@DndBase@WeaponA@Damage/\@DndBase@WeaponA@Type};
			\fi
		\fi
		%
		% Second Weapon: Name
		\ifdefined\@DndBase@WeaponB@Name
			\node[draw=none,rectangle,text width=2.0 cm,align=left]   at (4.45,-11.65) {\@DndBase@WeaponB@Name};
		\fi
		% Second Weapon: Attack bonus
		\ifdefined\@DndBase@WeaponB@AtkBonus
			\node[draw=none,rectangle,text width=0.8 cm,align=center] at (6.25,-11.65) {\DndDisplaySignedNum{\@DndBase@WeaponB@AtkBonus}};
		\fi
		% Second Weapon: damage / type
		\ifdefined\@DndBase@WeaponB@Damage
			\ifdefined\@DndBase@WeaponB@Type
				\node[draw=none,rectangle,text width=2.0 cm,align=left]   at (8.00,-11.65) {\@DndBase@WeaponB@Damage/\@DndBase@WeaponB@Type};
			\fi
		\fi
		%
		% Third Weapon: Name
		\ifdefined\@DndBase@WeaponC@Name
			\node[draw=none,rectangle,text width=2.0 cm,align=left]   at (4.45,-12.37) {\@DndBase@WeaponC@Name};
		\fi
		% Third Weapon: Attack bonus
		\ifdefined\@DndBase@WeaponC@AtkBonus
			\node[draw=none,rectangle,text width=0.8 cm,align=center] at (6.25,-12.37) {\DndDisplaySignedNum{\@DndBase@WeaponC@AtkBonus}};
		\fi
		% Third Weapon: damage / type
		\ifdefined\@DndBase@WeaponC@Damage
			\ifdefined\@DndBase@WeaponC@Type
				\node[draw=none,rectangle,text width=2.0 cm,align=left]   at (8.00,-12.37) {\@DndBase@WeaponC@Damage/\@DndBase@WeaponC@Type};
			\fi
		\fi
		%
		% Weapon notes (Sperate lines with '\\')
		\ifdefined\@DndBase@Weapons@Notes
			\node[draw=none,rectangle,text width=5.9 cm,align=left] at (6.22,-14.64) {%
				\setstretch{0.975}\small
				\parbox[][3.9 cm][t]{5.9 cm}{\@DndBase@Weapons@Notes}
			};
		\fi
		%
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		%
		%   Money
		%
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		%
		% Positional variables
		\ifalt
			\def \@Money@x {10}
			\def \@Money@y {-19.60}
			\def \@Money@distx {1.28}
			\def \@Money@disty {0}
			\def \@Units@CP {CP}
			\def \@Units@SP {SP}
			\def \@Units@EP {EP}
			\def \@Units@GP {GP}
			\def \@Units@PP {PP}
		\else
			\def \@Money@x {4.08}
			\def \@Money@y {-18.04}
			\def \@Money@distx {0}
			\def \@Money@disty {-0.9}
			\def \@Units@CP {}
			\def \@Units@SP {}
			\def \@Units@EP {}
			\def \@Units@GP {}
			\def \@Units@PP {}
		\fi
		% Copper
		\ifdefined\@DndBase@Money@Copper
			\node[draw=none,rectangle,text width=1 cm,align=center] at (\@Money@x,\@Money@y) {\@DndBase@Money@Copper \@Units@CP};
		\fi
		% Silver
		\ifdefined\@DndBase@Money@Silver
			\node[draw=none,rectangle,text width=1 cm,align=center] at (\@Money@x+\@Money@distx,\@Money@y+\@Money@disty) {\@DndBase@Money@Silver \@Units@SP};
		\fi
		% Electrum
		\ifdefined\@DndBase@Money@Electrum
			\node[draw=none,rectangle,text width=1 cm,align=center] at (\@Money@x+2*\@Money@distx,\@Money@y+2*\@Money@disty) {\@DndBase@Money@Electrum \@Units@EP};
		\fi
		% Gold
		\ifdefined\@DndBase@Money@Gold
			\node[draw=none,rectangle,text width=1 cm,align=center] at (\@Money@x+3*\@Money@distx,\@Money@y+3*\@Money@disty) {\@DndBase@Money@Gold \@Units@GP};
		\fi
		% Platin
		\ifdefined\@DndBase@Money@Platin
			\node[draw=none,rectangle,text width=1 cm,align=center] at (\@Money@x+4*\@Money@distx,\@Money@y+4*\@Money@disty) {\@DndBase@Money@Platin \@Units@PP};
		\fi
		%
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		%
		%   Equipment
		%   (Sperate lines with '\\')
		%
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		%
		% Positional variables
		\ifalt
			\def \@Equip@x {6.25}
			\def \@Equip@y {-22.30}
			\def \@Equip@width {5.9 cm}
		\else
			\def \@Equip@x {6.95}
			\def \@Equip@y {-20.41}
			\def \@Equip@width {4.15 cm}
		\fi
		\ifdefined\@DndBase@Base@Equipment
			\node[draw=none,rectangle,text width=\@Equip@width,align=left] at (\@Equip@x,\@Equip@y) {%
				\setstretch{0.975}\small
				\parbox[][5.7 cm][t]{\@Equip@width}{\@DndBase@Base@Equipment}
			};
		\fi
		%
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		%
		%   Personality traits
		%   (Sperate lines with '\\')
		%
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		%
		\ifdefined\@DndBase@Base@Traits
			\node[draw=none,rectangle,text width=5.2 cm,align=left] at (12.7,-2.81) {%
				\setstretch{1.1}\small
				\parbox[][1.5 cm][t]{5.2 cm}{\@DndBase@Base@Traits}
			};
		\fi
		%
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		%
		%   Ideals
		%   (Sperate lines with '\\')
		%
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		%
		\ifdefined\@DndBase@Base@Ideals
			\node[draw=none,rectangle,text width=5.2 cm,align=left] at (12.7,-4.93) {%
				\setstretch{1.1}\small
				\parbox[][1 cm][t]{5.2 cm}{\@DndBase@Base@Ideals}
			};
		\fi
		%
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		%
		%   Bonds
		%   (Sperate lines with '\\')
		%
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		%
		\ifdefined\@DndBase@Base@Bonds
			\node[draw=none,rectangle,text width=5.2 cm,align=left] at (12.7,-6.83) {%
				\setstretch{1.1}\small
				\parbox[][1 cm][t]{5.2 cm}{\@DndBase@Base@Bonds}
			};
		\fi
		%
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		%
		%   Flaws
		%   (Sperate lines with '\\')
		%
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		%
		\ifdefined\@DndBase@Base@Flaws
			\node[draw=none,rectangle,text width=5.2 cm,align=left] at (12.7,-8.73) {%
				\setstretch{1.1}\small
				\parbox[][1 cm][t]{5.2 cm}{\@DndBase@Base@Flaws}
			};
		\fi
		%
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		%
		%   Features & Traits
		%   (Sperate lines with '\\')
		%
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		%
		\ifdefined\@DndBase@Base@Features
			\node[draw=none,rectangle,text width=5.8 cm,align=left] at (12.7,-16.77) {%
				\setstretch{0.978}\small
				\parbox[][12.7 cm][t]{5.8 cm}{\@DndBase@Base@Features}
			};
		\fi
		%
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		%
		%   Additional notes
		%   (Sperate lines with '\\')
		%
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		%
		% Positional variables
		\ifalt
			\def \@Notes@x {12.55}
			\def \@Notes@y {-16.85}
		\else
			\def \@Notes@x {12.7}
			\def \@Notes@y {-16.85}
		\fi
		%
		\ifdefined\@DndBase@Base@Notes
			\node[draw=none,rectangle,text width=6.1 cm,align=left] at (\@Notes@x,\@Notes@y) {%
				\setstretch{0.8}\tiny
				\parbox[][12.9 cm][b]{6.1 cm}{
					\tcbset{
						frame code={},
						left=0pt,
						right=0pt,
						top=0pt,
						bottom=0pt,
						colback=white!30,
						width=\dimexpr\textwidth\relax,
						arc=0pt,outer arc=0pt,
					}
					\begin{tcolorbox}\@DndBase@Base@Notes\end{tcolorbox}
				}
			};
		\fi
		%
		\end{tikzpicture}}]{\basepdf}
} 